{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\cacma\\\\Downloads\\\\foodie-express-1\\\\foodie-express-v2\\\\foodie-express\\\\foodie-express-frontend\\\\src\\\\FavoritesContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// src/FavoritesContext.js\nimport React, { createContext, useContext, useEffect, useMemo, useState } from \"react\";\nimport { addFavorite, getFavorites, removeFavorite } from \"./api\";\nimport { useAuth } from \"./AuthContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst FavoritesContext = /*#__PURE__*/createContext(null);\nexport const useFavorites = () => {\n  _s();\n  return useContext(FavoritesContext);\n};\n_s(useFavorites, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nconst LS_KEY = \"fe_favorites_v2\";\nfunction safeParse(raw, fallback) {\n  try {\n    const v = JSON.parse(raw);\n    return v !== null && v !== void 0 ? v : fallback;\n  } catch {\n    return fallback;\n  }\n}\nexport function FavoritesProvider({\n  children\n}) {\n  _s2();\n  const {\n    user\n  } = useAuth();\n  const [favoriteIds, setFavoriteIds] = useState(() => safeParse(localStorage.getItem(LS_KEY), []));\n\n  // Sync: nếu có user -> load từ backend\n  useEffect(() => {\n    let alive = true;\n    (async () => {\n      if (!user) return;\n      try {\n        const data = await getFavorites();\n        const ids = (data.items || []).map(x => x.foodId || x.food || x._id).filter(Boolean);\n        if (alive) setFavoriteIds(ids);\n      } catch (e) {\n        console.warn(e);\n      }\n    })();\n    return () => {\n      alive = false;\n    };\n  }, [user]);\n  useEffect(() => {\n    localStorage.setItem(LS_KEY, JSON.stringify(favoriteIds));\n  }, [favoriteIds]);\n  const isFavorite = id => favoriteIds.includes(id);\n  const toggleFavorite = async foodId => {\n    if (!foodId) return;\n    const nextIsFav = !favoriteIds.includes(foodId);\n    setFavoriteIds(prev => nextIsFav ? [foodId, ...prev] : prev.filter(x => x !== foodId));\n\n    // Nếu login thì sync backend\n    if (user) {\n      try {\n        if (nextIsFav) await addFavorite(foodId);else await removeFavorite(foodId);\n      } catch (e) {\n        console.warn(e);\n      }\n    }\n  };\n  const clearFavorites = async () => {\n    // chỉ local clear (demo)\n    setFavoriteIds([]);\n  };\n  const value = useMemo(() => ({\n    favorites: favoriteIds,\n    isFavorite,\n    toggleFavorite,\n    clearFavorites\n  }), [favoriteIds]);\n  return /*#__PURE__*/_jsxDEV(FavoritesContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 10\n  }, this);\n}\n_s2(FavoritesProvider, \"qd85vfKL7fLem75qL3GKyOB+suM=\", false, function () {\n  return [useAuth];\n});\n_c = FavoritesProvider;\nvar _c;\n$RefreshReg$(_c, \"FavoritesProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useMemo","useState","addFavorite","getFavorites","removeFavorite","useAuth","jsxDEV","_jsxDEV","FavoritesContext","useFavorites","_s","LS_KEY","safeParse","raw","fallback","v","JSON","parse","FavoritesProvider","children","_s2","user","favoriteIds","setFavoriteIds","localStorage","getItem","alive","data","ids","items","map","x","foodId","food","_id","filter","Boolean","e","console","warn","setItem","stringify","isFavorite","id","includes","toggleFavorite","nextIsFav","prev","clearFavorites","value","favorites","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/cacma/Downloads/foodie-express-1/foodie-express-v2/foodie-express/foodie-express-frontend/src/FavoritesContext.js"],"sourcesContent":["// src/FavoritesContext.js\nimport React, { createContext, useContext, useEffect, useMemo, useState } from \"react\";\nimport { addFavorite, getFavorites, removeFavorite } from \"./api\";\nimport { useAuth } from \"./AuthContext\";\n\nconst FavoritesContext = createContext(null);\nexport const useFavorites = () => useContext(FavoritesContext);\n\nconst LS_KEY = \"fe_favorites_v2\";\n\nfunction safeParse(raw, fallback) {\n  try {\n    const v = JSON.parse(raw);\n    return v ?? fallback;\n  } catch {\n    return fallback;\n  }\n}\n\nexport function FavoritesProvider({ children }) {\n  const { user } = useAuth();\n  const [favoriteIds, setFavoriteIds] = useState(() => safeParse(localStorage.getItem(LS_KEY), []));\n\n  // Sync: nếu có user -> load từ backend\n  useEffect(() => {\n    let alive = true;\n    (async () => {\n      if (!user) return;\n      try {\n        const data = await getFavorites();\n        const ids = (data.items || []).map((x) => x.foodId || x.food || x._id).filter(Boolean);\n        if (alive) setFavoriteIds(ids);\n      } catch (e) {\n        console.warn(e);\n      }\n    })();\n    return () => {\n      alive = false;\n    };\n  }, [user]);\n\n  useEffect(() => {\n    localStorage.setItem(LS_KEY, JSON.stringify(favoriteIds));\n  }, [favoriteIds]);\n\n  const isFavorite = (id) => favoriteIds.includes(id);\n\n  const toggleFavorite = async (foodId) => {\n    if (!foodId) return;\n\n    const nextIsFav = !favoriteIds.includes(foodId);\n    setFavoriteIds((prev) => (nextIsFav ? [foodId, ...prev] : prev.filter((x) => x !== foodId)));\n\n    // Nếu login thì sync backend\n    if (user) {\n      try {\n        if (nextIsFav) await addFavorite(foodId);\n        else await removeFavorite(foodId);\n      } catch (e) {\n        console.warn(e);\n      }\n    }\n  };\n\n  const clearFavorites = async () => {\n    // chỉ local clear (demo)\n    setFavoriteIds([]);\n  };\n\n  const value = useMemo(\n    () => ({ favorites: favoriteIds, isFavorite, toggleFavorite, clearFavorites }),\n    [favoriteIds]\n  );\n\n  return <FavoritesContext.Provider value={value}>{children}</FavoritesContext.Provider>;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}